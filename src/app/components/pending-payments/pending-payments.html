<div class="pending-wrapper">

  <h2 class="page-title">ðŸ’° Pending Payments</h2>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      [class.active]="activeTab === 'sales'"
      (click)="activeTab = 'sales'">
      ðŸ§¾ Sales
    </button>

    <button 
      [class.active]="activeTab === 'repairs'"
      (click)="activeTab = 'repairs'">
      ðŸ”§ Repairs
    </button>
  </div>

  <!-- SALES TAB -->
  <ng-container *ngIf="activeTab === 'sales'">
    <div *ngIf="pendingSales.length; else emptySales">
      <div class="pending-card" *ngFor="let p of pendingSales">
        <ng-container *ngTemplateOutlet="card; context:{ $implicit: p }"></ng-container>
      </div>
    </div>
    <ng-template #emptySales>
      <div class="info-box">ðŸŽ‰ No pending sales!</div>
    </ng-template>
  </ng-container>

  <!-- REPAIRS TAB -->
  <ng-container *ngIf="activeTab === 'repairs'">
    <div *ngIf="pendingRepairs.length; else emptyRepairs">
      <div class="pending-card" *ngFor="let p of pendingRepairs">
        <ng-container *ngTemplateOutlet="card; context:{ $implicit: p }"></ng-container>
      </div>
    </div>
    <ng-template #emptyRepairs>
      <div class="info-box">ðŸŽ‰ No pending repairs!</div>
    </ng-template>
  </ng-container>

  <!-- Reusable Card Template -->
  <ng-template #card let-p>
    <div class="row1">
      <div>
        <b>
          {{ p.customerName || 'Unknown' }}
          <!-- <a [href]="'tel:' + p.customerPhone" class="phone-icon ml-3">ðŸ“ž</a> -->
           <a [href]="'tel:' + p.customerPhone" class="phone-icon ml-5">
  ðŸ“²
</a>
        </b>
        <p>{{ p.customerPhone }}</p>
      </div>

      <div class="amount">
        <span class="pending">â‚¹{{ p.pendingAmount }}</span>
      </div>
    </div>

    <div class="row1">
      <small class="type-badge" [ngClass]="p.type" *ngIf="p.type === 'repair'">{{ p.issue | titlecase }}</small>
      <small class="type-badge" [ngClass]="p.type" *ngIf="p.type === 'repair'">{{ p.deviceName | titlecase }}</small>
       <details class="items-details" *ngIf="p.type === 'sale'">
        <summary>Items Breakdown</summary>
        <ul>
          <li *ngFor="let i of p.items" style="word-break: break-word;">
            {{ i.name }} x {{ i.qty }} | Sold â‚¹{{ i.sellingPrice || i.price }} 
            <!-- <strong [ngClass]="{'profit-positive': ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty > 0,
                                 'profit-negative': ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty <= 0}">
              Profit â‚¹{{ ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty }}
            </strong> -->
          </li>
        </ul>
      </details>
    </div>

    <div class="row2">
      <span><b>Total:</b> â‚¹{{ p.total }}</span>
      <span><b>Paid:</b> â‚¹{{ p.paidAmount }}</span>
    </div>

    <div class="row3">
      <span><b>Date:</b> {{ p.date.toDate() | date:'medium' }}</span>
      <span><b>Mode:</b> {{ p.paymentMode }}</span>
    </div>

    <div class="actions mt-1">
  <button class="success" (click)="markPartialPaid(p)">
    Partially Paid
  </button>

  <button class="success" (click)="markFullyPaid(p)">
    Fully Paid
  </button>
</div>

  </ng-template>

</div>
