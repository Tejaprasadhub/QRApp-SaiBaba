<p-card header="Low Stock Products - Reorder">
  <ng-container *ngIf="!loading; else loadingTpl">
    <div *ngIf="grouped | keyvalue as groupedData; else noDataTpl">
      <div *ngFor="let cat of groupedData" class="p-mb-4">
        <h3>{{ cat.key }}</h3>
        <p-table [value]="cat.value" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Product</th>
              <th>Stock</th>
              <th>Min</th>
              <th>Qty to Order</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-p>
            <tr>
              <td>{{ p.name }}</td>
              <td>{{ p.stock }}</td>
              <td>{{ p.minStock }}</td>
              <td>{{ (p.minStock || 5) - (p.stock || 0) }}</td>
            </tr>
          </ng-template>
        </p-table>

        <div class="p-text-right p-mt-2">
          <p-button
            label="Create Purchase Order"
            icon="pi pi-shopping-cart"
            class="p-button-success"
            (click)="createOrder(cat.key, cat.value)"
          ></p-button>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="p-text-center p-m-4">
      <!-- <p-progressSpinner></p-progressSpinner> -->
      <p>Loading products...</p>
    </div>
  </ng-template>

  <ng-template #noDataTpl>
    <div class="p-text-center p-m-4">
      <p class="p-text-secondary">ðŸŽ‰ All products are sufficiently stocked!</p>
    </div>
  </ng-template>
</p-card>
