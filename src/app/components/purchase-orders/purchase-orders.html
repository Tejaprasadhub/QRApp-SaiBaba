<!-- <p-card header="Purchase Orders">
  <p-table [value]="(purchaseOrders$ | async) ?? []" [paginator]="true" [rows]="10" responsiveLayout="scroll" dataKey="id">
    <ng-template pTemplate="header">
      <tr>
        <th>Order Date</th>
        <th>Category</th>
        <th>Status</th>
        <th>Items Count</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-order>
      <tr>
        <td>{{ order.date?.toDate ? (order.date.toDate() | date:'medium') : (order.date | date:'medium') }}</td>
        <td>{{ order.categoryName }}</td>
        <td>
          <span class="p-tag p-tag-rounded" [ngClass]="{
            'p-tag-success': order.status === 'received',
            'p-tag-warning': order.status === 'pending'
          }">
            {{ order.status | titlecase }}
          </span>
        </td>
        <td>{{ order.items?.length }}</td>
        <td>
          <p-button
            icon="pi pi-eye"
            label="View"
            (click)="viewOrder(order)"
            styleClass="p-button-text p-mr-2"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>

<p-dialog header="Purchase Order Details" [(visible)]="displayDialog" [modal]="true" [style]="{width: '500px'}">
  <ng-container *ngIf="selectedOrder">
    <div>
      <p><strong>Category:</strong> {{ selectedOrder.categoryName }}</p>
      <p><strong>Status:</strong> {{ selectedOrder.status | titlecase }}</p>
      <p><strong>Date:</strong> {{ selectedOrder.date?.toDate ? (selectedOrder.date.toDate() | date:'medium') : (selectedOrder.date | date:'medium') }}</p>
    </div>

    <h4>Items</h4>
    <p-table [value]="selectedOrder.items" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Product</th>
          <th>Qty Ordered</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.orderQty }}</td>
        </tr>
      </ng-template>
    </p-table>

    <div class="p-mt-3 p-text-right">
      <p-button
        *ngIf="selectedOrder.status !== 'received'"
        label="Mark as Received"
        icon="pi pi-check"
        class="p-button-success p-mr-2"
        (click)="markAsReceived(selectedOrder)"
      ></p-button>

      <p-button
        label="Delete"
        icon="pi pi-trash"
        class="p-button-danger p-mr-2"
        (click)="deleteOrder(selectedOrder)"
      ></p-button>

      <p-button label="Close" icon="pi pi-times" class="p-button-secondary" (click)="displayDialog=false"></p-button>
    </div>
  </ng-container>
</p-dialog> -->

<p-card header="Purchase Orders">
  <p-table [value]="(purchaseOrders$ | async) ?? []" [paginator]="true" [rows]="10" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>Order Date</th>
        <th>Category</th>
        <th>Status</th>
        <th>Items</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-order>
      <tr>
        <td>{{ order.date?.toDate ? (order.date.toDate() | date:'medium') : (order.date | date:'medium') }}</td>
        <td>{{ order.categoryName }}</td>
        <td>{{ order.status | titlecase }}</td>
        <td>{{ order.items?.length }}</td>
        <td>
          <p-button label="View" icon="pi pi-eye" (click)="viewOrder(order)" styleClass="p-button-text"></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>

<!-- Purchase Order Details -->
<p-dialog header="Purchase Order Details" [(visible)]="displayDialog" [modal]="true" [style]="{ width: '600px' }">
  <ng-container *ngIf="selectedOrder">
    <h4>{{ selectedOrder.categoryName }}</h4>
    <p-table [value]="selectedOrder.items" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Product</th>
          <th>Ordered</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.orderQty }}</td>
          <td>
            <span class="p-tag" [ngClass]="{
              'p-tag-success': item.received,
              'p-tag-warning': !item.received
            }">
              {{ item.received ? 'Received' : 'Pending' }}
            </span>
          </td>
          <td>
            <p-button
              *ngIf="!item.received"
              label="Mark as Received"
              icon="pi pi-check"
              class="p-button-success p-button-sm"
              (click)="startEdit(item)"
            ></p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Inline edit area -->
    <div *ngIf="editingItem" class="p-mt-3 p-fluid">
      <h5>Receiving: {{ editingItem.name }}</h5>
      <div class="p-field">
        <label>Received Quantity</label>
        <input pInputText type="number" [(ngModel)]="editingItem.receivedQty" />
      </div>
      <div class="p-field">
        <label>New Product Price</label>
        <input pInputText type="number" [(ngModel)]="editingItem.newPrice" />
      </div>
      <div class="p-text-right p-mt-2">
        <p-button
          label="Save"
          icon="pi pi-save"
          class="p-button-success p-mr-2"
          (click)="saveItemReceipt(selectedOrder, editingItem)"
        ></p-button>
        <p-button
          label="Cancel"
          icon="pi pi-times"
          class="p-button-secondary"
          (click)="editingItem = null"
        ></p-button>
      </div>
    </div>

    <div class="p-text-right p-mt-3">
      <p-button label="Close" icon="pi pi-times" (click)="displayDialog=false"></p-button>
    </div>
  </ng-container>
</p-dialog>

