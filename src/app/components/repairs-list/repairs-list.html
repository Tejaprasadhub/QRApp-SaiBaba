<div class="repairs-wrapper">

  <!-- HEADER -->
  <div class="header-row">
    <h2 class="page-title">ðŸ›  Repairs List</h2>
    <button class="btn-add" routerLink="/repair-form">
      âž• Add Repair
    </button>
  </div>

  <!-- FILTER BAR -->
  <div class="filter-bar">

    <div class="filter-item">
      <label>From</label>
      <input
        type="date"
        [(ngModel)]="startDateStr"
        (change)="onFiltersChanged()" />
    </div>

    <div class="filter-item">
      <label>To</label>
      <input
        type="date"
        [(ngModel)]="endDateStr"
        (change)="onFiltersChanged()" />
    </div>

    <div class="filter-item">
      <!-- <label>Status</label> -->
      <select [(ngModel)]="filterStatus" (change)="onFiltersChanged()">
        <option value="">All</option>
        <option value="pending">Pending</option>
        <option value="completed">Completed</option>
      </select>
    </div>

    <div class="filter-item search">
      <input
        type="text"
        placeholder="ðŸ” Search name / phone"
        [(ngModel)]="searchText"
        (input)="applySearch()" />
    </div>

    <!-- <div class="filter-item toggle">
      <label>
        <input
          type="checkbox"
          [(ngModel)]="realtime"
          (change)="onFiltersChanged()" />
        <span>Realtime</span>
      </label>
    </div> -->

  </div>
  <!-- TOTAL SERVICE AMOUNT -->
  <div class="total-service-amount mb-2">
    Total Service Amount: <strong>â‚¹{{ totalServiceAmount }}</strong>
  </div>

  <!-- LIST -->
  <div class="card-list" *ngIf="filtered.length > 0">

    <div class="repair-card" *ngFor="let r of filtered">

      <!-- CARD HEADER -->
      <div class="card-top">
        <div>
          <strong>{{ r.customerName || 'Unknown' }}</strong>
          <small>{{ r.customerPhone }}</small>
        </div>

        <span class="status-pill" [ngClass]="r.status">
          {{ r.status | titlecase }}
        </span>
      </div>

      <!-- CARD BODY -->
      <div class="card-body">
        <div><b>Device:</b> {{ r.deviceName }}</div>
        <div><b>Issue:</b> {{ r.issue }}</div>
        <div class="meta">
          <span>ðŸ“… {{ r.inDate?.toDate() | date:'mediumDate' }}</span>
          <span>Total: â‚¹{{ r.estimatedAmount }}</span>
          <span>Paid: â‚¹{{ r.paidAmount }}</span>
          
        </div>
         <div class="meta actions">
          <span>Service Amount: â‚¹{{ r?.serviceAmount || 0 }}</span>
          <span>
          <button  (click)="addServiceAmount(r)">
            {{ r?.serviceAmount > 0 ? 'Edit' : 'Add' }} Service Amount
          </button>
        </span>
        </div>
      </div>

      <!-- CARD FOOTER -->
      <div class="card-footer">
        <span class="pending" *ngIf="r.pendingAmount > 0">
          Pending â‚¹{{ r.pendingAmount }}
        </span>       
        
        <div class="actions">
          <button
            *ngIf="r.pendingAmount > 0"
            (click)="addPayment(r)">
            Add Payment
          </button>
          
          <button
            *ngIf="r.status !== 'completed' && r.serviceAmount > 0"
            class="success"
            (click)="completeWithPayment(r)">
            Complete
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- EMPTY -->
  <div class="empty-state" *ngIf="filtered.length === 0">
    No repair jobs found.
  </div>

</div>
