<div class="customer-history">

  <!-- TITLE -->
  <div class="page-title">
    <h2>Customer History</h2>
    <p>Search customer by phone number</p>
  </div>

  <!-- SEARCH -->
  <div class="search-box">
    <input
      type="text"
      placeholder="Enter customer phone number"
      [(ngModel)]="phone"
      (ngModelChange)="onPhoneChange()"
    />
  </div>

  <!-- EMPTY -->
  <div *ngIf="!customer" class="hint">
    Enter phone number to view customer details
  </div>

  <div *ngIf="customer">

    <!-- CUSTOMER SUMMARY -->
    <div class="summary-card">
      <div>
        <h3>{{ customer.name }}</h3>
        <span>{{ customer.phone }}</span>
      </div>

      <div class="pending-box">
        <span>Total Pending</span>
        <strong>₹{{ totalPending }}</strong>
      </div>
    </div>

    <!-- SALES -->
    <section class="section">
      <h4>Sales History</h4>

      <div *ngIf="sales.length === 0" class="empty">No sales found</div>

      <div class="card data-card mb-2" *ngFor="let s of sales">

        <div class="data-grid">
          <div><label>Sale ID</label><span>{{ s.id }}</span></div>
          <div><label>Date</label><span>{{ s.date?.toDate() | date:'short' }}</span></div>
          <div><label>Total</label><span>₹{{ s.total }}</span></div>
          <div><label>Paid</label><span class="paid">₹{{ s.paidAmount }}</span></div>
          <div>
            <label>Pending</label>
            <span class="pending" [class.zero]="s.pendingAmount === 0">
              ₹{{ s.pendingAmount }}
            </span>
          </div>
          <div><label>Status</label><span>{{ s.paymentStatus }}</span></div>
        </div>

        <!-- ITEMS -->
        <div class="items">
          <div class="item" *ngFor="let i of s.items">
            <span>{{ i.name }} × {{ i.qty }}</span>
            <strong
              [ngClass]="{
                'profit-positive': ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty > 0,
                'profit-negative': ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty <= 0
              }">
              ₹{{ ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty }}
            </strong>
          </div>
        </div>

      </div>
    </section>

    <!-- REPAIRS -->
    <section class="section">
      <h4>Repairs History</h4>

      <div *ngIf="repairs.length === 0" class="empty">No repairs found</div>

      <div class="card data-card mb-2" *ngFor="let r of repairs">
        <div class="data-grid">
          <div><label>Device</label><span>{{ r.deviceName }}</span></div>
          <div><label>Issue</label><span>{{ r.issue }}</span></div>
          <div><label>Date</label><span>{{ r.inDate?.toDate() | date:'short' }}</span></div>
          <div><label>Total</label><span>₹{{ r.estimatedAmount }}</span></div>
          <div><label>Paid</label><span class="paid">₹{{ r.paidAmount }}</span></div>
          <div><label>Pending</label><span class="pending">₹{{ r.pendingAmount }}</span></div>
          <div><label>Status</label><span>{{ r.status }}</span></div>
        </div>
      </div>
    </section>

  </div>
</div>
