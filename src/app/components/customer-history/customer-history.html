<div class="customer-history-container">

  <h2>üì± Customer History</h2>

  <input 
    type="text"
    placeholder="Enter customer phone..."
    [(ngModel)]="phone"
    (ngModelChange)="onPhoneChange()"
    class="phone-input"
  />

  <div *ngIf="!customer" class="no-data">
    Enter customer phone to load history.
  </div>

  <div *ngIf="customer" class="history-content">

    <!-- CUSTOMER INFO -->
    <div class="customer-card">
      <h3>{{ customer.name }}</h3>
      <p>üìû {{ customer.phone }}</p>
      <p>Total Pending: <b>‚Çπ{{ totalPending }}</b></p>
    </div>

    <!-- SALES HISTORY -->
    <div class="section">
      <h3>üßæ Sales History</h3>
      <div *ngIf="sales.length === 0" class="empty">No sales found</div>

      <div class="card" *ngFor="let s of sales">
        <div class="row">
          <b>Sale ID:</b> <span>{{ s.id }}</span>
        </div>
        <div class="row">
          <b>Date:</b> <span>{{ s.date?.toDate() | date:'short' }}</span>
        </div>
        <div class="row">
          <b>Estimated Amount:</b> <span>‚Çπ{{ s.total }}</span>
        </div>
        <div class="row">
          <b>Paid Amount:</b> <span>‚Çπ{{ s.paidAmount }}</span>
        </div>
        <div class="row">
          <b>Pending Amount:</b> 
          <span [class.pending]="s.pendingAmount > 0">
            ‚Çπ{{ s.pendingAmount }}
          </span>
        </div>
        <div class="row">
          <b>Status:</b> <span>{{ s.paymentStatus }}</span>
        </div>

        <div class="items">
          <div *ngFor="let i of s.items">
             {{ i.name }} x {{ i.qty }} | Cost ‚Çπ{{ i.costPrice || 0 }} | Sold ‚Çπ{{ i.sellingPrice || i.price }} |
                <strong [ngClass]="{'profit-positive': ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty > 0,
                                     'profit-negative': ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty <= 0}">
                  Profit ‚Çπ{{ ((i.sellingPrice || i.price) - (i.costPrice || 0)) * i.qty }}
                </strong>
          </div>
        </div>
      </div>
    </div>

    <!-- REPAIRS HISTORY -->
    <div class="section">
      <h3>üõ†Ô∏è Repairs History</h3>
      <div *ngIf="repairs.length === 0" class="empty">No repairs found</div>

      <div class="card" *ngFor="let r of repairs">
        <div class="row"><b>Device:</b> <span>{{ r.deviceName }}</span></div>
        <div class="row"><b>Issue:</b> <span>{{ r.issue }}</span></div>
        <div class="row"><b>Date:</b> <span>{{ r.inDate?.toDate() | date:'short' }}</span></div>
        <div class="row"><b>Estimated Amount:</b> <span>‚Çπ{{ r.estimatedAmount }}</span></div>
        <div class="row"><b>Paid Amount:</b> <span>‚Çπ{{ r.paidAmount }}</span></div>
        <div class="row"><b>Pending Amount:</b> <span class="pending">‚Çπ{{ r.pendingAmount }}</span></div>
        <div class="row"><b>Status:</b> <span>{{ r.status }}</span></div>
      </div>
    </div>

  </div>

</div>
